{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add/Edit Job with Skills</title>
    <link rel="stylesheet" href="{% static 'css/global.css' %}">
    <style>
        .toggle {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider-toggle {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider-toggle:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider-toggle {
            background-color: #2196F3;
        }

        input:checked + .slider-toggle:before {
            transform: translateX(26px);
        }

        #toggle-label {
            margin-left: 10px;
            font-size: 16px;
            vertical-align: middle;
        }

        .slider-container {
            margin-bottom: 20px;
        }

        .slider {
            width: 100%;
        }

        .slider-value {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        .slider-months-container {
            display: none;
        }
    </style>
</head>
<body>
    <h1>{% if job_id %}Edit Job{% else %}Add Job{% endif %}</h1>

    <!-- Toggle Button for Increment by Years/Months -->
    <label class="toggle">
        <input type="checkbox" id="toggle-increment">
        <span class="slider-toggle"></span>
        <span id="toggle-label">Increment by Years</span>
    </label>

    <form method="POST" novalidate>
        {% csrf_token %}
        <div class="selected-job">
            <h3>Selected Job: {{ job.name }}</h3>
            <input type="hidden" name="job_id" value="{{ job.id }}">
        </div>

        {{ job_form.as_p }}

        <h3>Skills</h3>
        <table id="formset-container">
            {{ formset.management_form }}
            <thead>
                <tr>
                    <th>Skill</th>
                    <th>Years of Experience</th>
                </tr>
            </thead>
            <tbody>
                {% for form in formset %}
                <tr class="form-row">
                    {{ form.id }}
                    <td class="form-group">
                        {{ form.skill }}
                        {% if form.skill.errors %}
                            <div class="error-message">{{ form.skill.errors }}</div>
                        {% endif %}
                    </td>
                    <td class="form-group">
                        <div class="slider-container">
                            <input type="range" class="slider" min="0" max="120" value="0" name="years_required">
                            <input type="hidden" name="skill_months_{{ forloop.counter0 }}" class="skill-months" value="0">
                            <div class="slider-value">
                                <span>Years: <span class="slider-years">0</span></span>
                                <span class="slider-months-container">Months: <span class="slider-months">0</span></span>
                            </div>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <button type="submit">Save</button>
    </form>

    <script>
        // Get references to all sliders and the toggle switch
        const sliders = document.querySelectorAll('.slider');
        const toggleIncrement = document.getElementById('toggle-increment');
        const toggleLabel = document.getElementById('toggle-label');
        let incrementByYears = true;

        // Handle the toggle between years and months
        toggleIncrement.addEventListener('change', function () {
            incrementByYears = !incrementByYears;

            sliders.forEach((slider, index) => {
                const yearsDisplay = slider.parentElement.querySelector('.slider-years');
                const monthsDisplay = slider.parentElement.querySelector('.slider-months');
                const sliderValue = parseInt(slider.value);

                if (incrementByYears) {
                    // Convert months to years when switching to increment by years
                    slider.max = 10; // Max 10 years
                    slider.value = Math.floor(sliderValue / 12); // Convert months to years
                    yearsDisplay.textContent = slider.value;
                    monthsDisplay.textContent = 0;

                    // Update the hidden input for months
                    const hiddenInput = document.querySelector(`input[name="skill_months_${index}"]`);
                    hiddenInput.value = 0;

                    document.querySelectorAll('.slider-months-container').forEach(container => container.style.display = 'none');
                    toggleLabel.textContent = "Increment by Years";
                } else {
                    // Convert years to months when switching to increment by months
                    slider.max = 120; // Max 120 months (10 years)
                    slider.value = sliderValue * 12; // Convert years to months
                    yearsDisplay.textContent = Math.floor(slider.value / 12);
                    monthsDisplay.textContent = slider.value % 12;

                    // Update the hidden input for months
                    const hiddenInput = document.querySelector(`input[name="skill_months_${index}"]`);
                    hiddenInput.value = monthsDisplay.textContent;

                    document.querySelectorAll('.slider-months-container').forEach(container => container.style.display = 'inline');
                    toggleLabel.textContent = "Increment by Months";
                }
            });
        });

        // Handle slider input changes
        sliders.forEach((slider, index) => {
            slider.oninput = function () {
                const yearsDisplay = this.parentElement.querySelector('.slider-years');
                const monthsDisplay = this.parentElement.querySelector('.slider-months');
                const sliderValue = this.value;

                if (!incrementByYears) {
                    // Incrementing by months
                    const years = Math.floor(sliderValue / 12);
                    const months = sliderValue % 12;
                    yearsDisplay.textContent = years;
                    monthsDisplay.textContent = months;

                    // Update the hidden input for months
                    const hiddenInput = document.querySelector(`input[name="skill_months_${index}"]`);
                    hiddenInput.value = months; // Update hidden input for months
                } else {
                    // Incrementing by years
                    yearsDisplay.textContent = sliderValue;
                    monthsDisplay.textContent = 0; // Reset months when incrementing by years

                    // Update the hidden input for months
                    const hiddenInput = document.querySelector(`input[name="skill_months_${index}"]`);
                    hiddenInput.value = 0; // Set months to 0 when using years
                }
            };
        });
    </script>
</body>
</html>
