<!-- Add a toggle switch for showing/hiding months -->
<label for="toggle-months">Show months</label>
<input type="checkbox" id="toggle-months" name="toggle-months" checked>

<form method="POST" novalidate>
    {% csrf_token %}
    
    <div class="selected-job">
        <h3>Selected Job: {{ job.name }}</h3>
        <input type="hidden" name="job_id" value="{{ job.id }}">
    </div>
    
    {{ job_form.as_p }} <!-- Render the job form -->

    <h3>Skills</h3>
    <table id="formset-container">
        {{ formset.management_form }}
        <thead>
            <tr>
                <th>Skill</th>
                <th>Years of Experience</th>
            </tr>
        </thead>
        <tbody>
            {% for form in formset %}
            <tr class="form-row">
                {{ form.id }}  <!-- Render the id field as a hidden input -->
                <td class="form-group">
                    {{ form.skill }}
                    {% if form.skill.errors %}
                        <div class="error-message">{{ form.skill.errors }}</div>
                    {% endif %}
                </td>
                <td class="form-group">
                    <input type="range" class="slider" min="0" max="{{ max_slider_value }}" value="0" name="years_required">
                    
                    <!-- Years and Months displayed on the same line -->
                    <p>
                        Years: <span class="slider-years">{{ form.skill_years.value|default:0 }}</span>, 
                        <span class="slider-months-container">Months: <span class="slider-months">{{ form.skill_months.value|default:0 }}</span></span>
                    </p>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <button type="submit">Save</button>
</form>

<!-- JavaScript Section -->
<script>
    const sliders = document.querySelectorAll('.slider');
    const toggleMonths = document.getElementById('toggle-months');
    let showMonths = toggleMonths.checked; // Initially, months are shown

    toggleMonths.addEventListener('change', function () {
        showMonths = this.checked;

        sliders.forEach(slider => {
            if (showMonths) {
                slider.max = 120; // 10 years * 12 months
                document.querySelectorAll('.slider-months-container').forEach(container => container.style.display = 'inline');
            } else {
                slider.max = 10; // 10 years max when months are hidden
                document.querySelectorAll('.slider-months-container').forEach(container => container.style.display = 'none');
            }
        });
    });

    sliders.forEach(slider => {
        slider.oninput = function () {
            const yearsDisplay = this.parentElement.querySelector('.slider-years');
            const monthsDisplay = this.parentElement.querySelector('.slider-months');
            const sliderValue = this.value;

            if (showMonths) {
                const years = Math.floor(sliderValue / 12);
                const months = sliderValue % 12;
                yearsDisplay.textContent = years;
                monthsDisplay.textContent = months;
            } else {
                yearsDisplay.textContent = sliderValue;
            }
        };
    });
</script>
